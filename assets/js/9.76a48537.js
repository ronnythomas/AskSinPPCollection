(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{177:function(e,n,t){e.exports=t.p+"assets/img/ftdi-verkantet.ba30dcc3.jpg"},199:function(e,n,t){"use strict";t.r(n);var s={props:["slot-key"],mounted:function(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},a=t(6),r=Object(a.a)(s,function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.slotKey}},[s("h1",{attrs:{id:"software-flashen"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#software-flashen","aria-hidden":"true"}},[e._v("#")]),e._v(" Software / Flashen")]),e._v(" "),s("p",[e._v("Die Software für den Microcontroller wird bei Arduino als "),s("em",[e._v("Sketch")]),e._v(" bezeichnet."),s("br"),e._v("\nDer USB FTDI Adapter ist die Verbindung zwischen Microcontroller und PC.")]),e._v(" "),s("h2",{attrs:{id:"arduino-ide"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arduino-ide","aria-hidden":"true"}},[e._v("#")]),e._v(" Arduino IDE")]),e._v(" "),s("p",[e._v("Die "),s("a",{attrs:{href:"https://www.arduino.cc/en/Main/Software",target:"_blank",rel:"noopener noreferrer"}},[e._v("Arduino IDE"),s("OutboundLink")],1),e._v(" ist die gebräuchlichste\nPC Software für den Umgang mit dem Arduino.")]),e._v(" "),s("h3",{attrs:{id:"bibliothek-einbinden"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bibliothek-einbinden","aria-hidden":"true"}},[e._v("#")]),e._v(" Bibliothek einbinden")]),e._v(" "),s("p",[e._v("Damit die im Sketch verwendeten Bibliotheken zur Verfügung stehen, müssen diese eingebunden werden:")]),e._v(" "),s("ul",[s("li",[e._v("AskSinPP")]),e._v(" "),s("li",[e._v("EnableInterrupt")]),e._v(" "),s("li",[e._v("Low-Power")])]),e._v(" "),s("p",[e._v("Die AskSinPP Bibliothek kann als "),s("a",{attrs:{href:"https://github.com/pa-pa/AskSinPP/archive/V3.zip",target:"_blank",rel:"noopener noreferrer"}},[e._v("ZIP"),s("OutboundLink")],1),e._v("\nheruntergeladen werden.\nAnschließend geht man in der Arduino IDE auf "),s("code",[e._v("Sketch > Bibliothek einbinden > .ZIP-Bibliothek hinzufügen")]),e._v("\nund wählt die ZIP-Datei aus.")]),e._v(" "),s("p",[e._v("EnableInterrupt und Low-Power wird über "),s("code",[e._v("Sketch > Bibliothek einbinden > Bibliotheken verwalten")]),e._v("\ngesucht und installiert.")]),e._v(" "),s("h3",{attrs:{id:"board-einstellen"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#board-einstellen","aria-hidden":"true"}},[e._v("#")]),e._v(" Board einstellen")]),e._v(" "),s("ul",[s("li",[e._v("Board: "),s("code",[e._v("Arduino Pro or Pro Mini")])]),e._v(" "),s("li",[e._v("Prozessor: "),s("code",[e._v("ATmega328P (3.3V, 8 MHz)")])]),e._v(" "),s("li",[e._v("Port: COM-Port des FTDI Adapters")])]),e._v(" "),s("h2",{attrs:{id:"platformio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#platformio","aria-hidden":"true"}},[e._v("#")]),e._v(" PlatformIO")]),e._v(" "),s("p",[e._v("PlatformIO gibt es als vollständige "),s("a",{attrs:{href:"https://platformio.org/platformio-ide",target:"_blank",rel:"noopener noreferrer"}},[e._v("Entwicklungsumgebung"),s("OutboundLink")],1),e._v(" (IDE) und als "),s("a",{attrs:{href:"https://platformio.org/install/cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Command-Line-Interface"),s("OutboundLink")],1),e._v(" (CLI).")]),e._v(" "),s("p",[e._v("Die nötigen Bibliotheken können über den "),s("a",{attrs:{href:"https://docs.platformio.org/en/latest/librarymanager/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Library Manager"),s("OutboundLink")],1),e._v("\nbequem installiert werden. Er enthält neben den gebräuchlichen EnableInterrupt und Low-Power auch AskSinPP.")]),e._v(" "),s("p",[e._v("Die Konfiguration des Boards kann über das Interface eingestellt werden und wird in der "),s("code",[e._v("platformio.ini")]),e._v(" im\nProjekt-Verzeichnis gespeichert. Diese Datei kann man sich also auch schnell selbst erstellen:")]),e._v(" "),s("div",{staticClass:"language-ini line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{attrs:{class:"token selector"}},[e._v("[env:pro8MHzatmega328]")]),e._v("\n"),s("span",{attrs:{class:"token constant"}},[e._v("platform")]),e._v(" "),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" atmelavr")]),e._v("\n"),s("span",{attrs:{class:"token constant"}},[e._v("framework")]),e._v(" "),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" arduino")]),e._v("\n"),s("span",{attrs:{class:"token constant"}},[e._v("board")]),e._v(" "),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" pro8MHzatmega328")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h2",{attrs:{id:"anschluss-des-ftdi-adapters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#anschluss-des-ftdi-adapters","aria-hidden":"true"}},[e._v("#")]),e._v(" Anschluss des FTDI Adapters")]),e._v(" "),s("p",[e._v("Um die Schaltung sehr kompakt zu halten, verzichtet man auf das Anlöten eines Steckverbinders.\nEs reicht aus, wenn man die Pins des FTDI Adapters durch die Lötbohrungen steckt und während des Flash-Vorgangs verkantet.")]),e._v(" "),s("p",[s("img",{attrs:{src:t(177),alt:"FTP Adapter verkantet am Arduino Pro Mini"}})]),e._v(" "),s("h2",{attrs:{id:"sketch-anpassen-und-flashen"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sketch-anpassen-und-flashen","aria-hidden":"true"}},[e._v("#")]),e._v(" Sketch anpassen und flashen")]),e._v(" "),s("p",[e._v("Es gibt mittlerweile viele fertige "),s("router-link",{attrs:{to:"/Sketche/"}},[e._v("Sketche")]),e._v(" die je nach Aktor oder Sensor verwendet werden können."),s("br"),e._v("\nAls Beispiel wird hier der "),s("code",[e._v("HM-RC-P1")]),e._v(" Paniktaster genommen.")],1),e._v(" "),s("p",[e._v("Der komplette Sketch ist "),s("a",{attrs:{href:"https://github.com/pa-pa/AskSinPP/blob/master/examples/HM-RC-P1/HM-RC-P1.ino",target:"_blank",rel:"noopener noreferrer"}},[e._v("HM-RC-P1.ino"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token comment"}},[e._v("// Arduino pin for the config button")]),e._v("\n"),s("span",{attrs:{class:"token macro property"}},[e._v("#"),s("span",{attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" CONFIG_BUTTON_PIN 8")]),e._v("\n"),s("span",{attrs:{class:"token comment"}},[e._v("// Arduino pins for the buttons")]),e._v("\n"),s("span",{attrs:{class:"token comment"}},[e._v("// A0 == PIN 14")]),e._v("\n"),s("span",{attrs:{class:"token macro property"}},[e._v("#"),s("span",{attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" BTN1_PIN 14")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("Hier sieht man die Button Belegung und kann diese entsprechend anpassen."),s("br"),e._v("\nFür das Beispiel des Paniktasters schließen wir also einen weiteren Taster an "),s("code",[e._v("A0")]),e._v(" und "),s("code",[e._v("GND")]),e._v(" an.")]),e._v(" "),s("p",[e._v("Weiterhin ist der DeviceInfo Block wichtig:")]),e._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token comment"}},[e._v("// define all device properties")]),e._v("\n"),s("span",{attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" DeviceInfo PROGMEM devinfo "),s("span",{attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{attrs:{class:"token number"}},[e._v("0x12")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{attrs:{class:"token number"}},[e._v("0x09")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{attrs:{class:"token number"}},[e._v("0x01")]),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v("       "),s("span",{attrs:{class:"token comment"}},[e._v("// Device ID")]),e._v("\n    "),s("span",{attrs:{class:"token string"}},[e._v('"JPLRCP2001"')]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v("           "),s("span",{attrs:{class:"token comment"}},[e._v("// Device Serial")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{attrs:{class:"token number"}},[e._v("0x00")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{attrs:{class:"token number"}},[e._v("0x1a")]),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v("            "),s("span",{attrs:{class:"token comment"}},[e._v("// Device Model")]),e._v("\n    "),s("span",{attrs:{class:"token number"}},[e._v("0x11")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v("                   "),s("span",{attrs:{class:"token comment"}},[e._v("// Firmware Version")]),e._v("\n    as"),s("span",{attrs:{class:"token operator"}},[e._v("::")]),e._v("DeviceType"),s("span",{attrs:{class:"token operator"}},[e._v("::")]),e._v("Remote"),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token comment"}},[e._v("// Device Type")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{attrs:{class:"token number"}},[e._v("0x00")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),s("span",{attrs:{class:"token number"}},[e._v("0x00")]),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),e._v("             "),s("span",{attrs:{class:"token comment"}},[e._v("// Info Bytes")]),e._v("\n"),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("Jedes Gerät in einer HomeMatic Umgebung hat 2 eindeutige Identifikationsmerkmale:")]),e._v(" "),s("ul",[s("li",[e._v("die 10-stellige Seriennummer (wird in der WebUI in der Spalte Seriennummer in Einstellungen->Geräte angezeigt)")]),e._v(" "),s("li",[e._v("die 3-Byte Geräteadresse (wird in einer Konfigurationsdatei im Dateisystem gespeichert)")])]),e._v(" "),s("p",[e._v("Beide dürfen in einer HomeMatic-Installation nur "),s("strong",[e._v("1x vergeben")]),e._v(" werden."),s("br"),e._v("\nAusschlaggebend für die Funk-Kommunikation ist die Geräte-Adresse.")])]),e._v(" "),s("p",[e._v("Die Geräteadresse (im Sketch als "),s("code",[e._v("Device ID")]),e._v(" bezeichnet) lautet in diesem Fall "),s("code",[e._v("0x12,0x09,0x01")]),e._v("."),s("br"),e._v("\nDie Seriennummer (im Sketch als "),s("code",[e._v("Device Serial")]),e._v(" bezeichnet) lautet in diesem Fall "),s("code",[e._v("JPLRCP2001")]),e._v(".")]),e._v(" "),s("p",[e._v("Soll ein weiterer, auf diesen Sketch basierender HM-RC-P1 ins HomeMatic System integriert werden, verwendet man (- so mache ich es zumindest-) am besten eine fortlaufende Numerierung. 0x12, 0x09, 0x02 / JPLRCP2002.")]),e._v(" "),s("p",[e._v("Wichtig: Die Seriennummer muss immer 10-stellig sein! Sie darf Buchstaben und Zahlen enthalten.")]),e._v(" "),s("p",[e._v("Sind die Werte angepasst, kann der Programmcode kompiliert und an den Mikrocontroller\nübertragen werden. In der Arduino IDE heißt dieser Vorgang "),s("code",[e._v("Sketch hochladen")]),e._v("\nund bei PlatformIO "),s("code",[e._v("upload")]),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"serieller-monitor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serieller-monitor","aria-hidden":"true"}},[e._v("#")]),e._v(" Serieller Monitor")]),e._v(" "),s("p",[e._v("Der Arduino verfügt über eine Debug-Ausgabe die vom PC über den "),s("code",[e._v("seriellen Monitor")]),e._v("\nabgerufen werden kann (Arduino IDE: Menü > Werkzeuge > serieller Monitor).\nAus dem Sketch kann man die verwendete Baudrate ablesen:")]),e._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[e._v("void")]),e._v(" setup "),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{attrs:{class:"token function"}},[e._v("DINIT")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token number"}},[e._v("57600")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v("ASKSIN_PLUS_PLUS_IDENTIFIER"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  sdev"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("init")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("hal"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("Hier also "),s("strong",[e._v("57600 Baud")]),e._v(". Diese muss beim Verbindungsaufbau übereinstimmen, damit man\nnicht nur wirre Zeichen erhält. Weiteres zum "),s("router-link",{attrs:{to:"/Grundlagen/FAQ/Debugging.html"}},[e._v("Debugging")]),e._v(" in den FAQ.")],1)])},[],!1,null,null,null);r.options.__file="02_software.md";n.default=r.exports}}]);